# Vietnamese Ziwei Doushu (T·ª≠ Vi ƒê·∫©u S·ªë) - TypeScript

A TypeScript implementation of Vietnamese Ziwei Doushu (T·ª≠ Vi ƒê·∫©u S·ªë) natal chart calculation. This library ports the "an sao" (star positioning) logic to generate complete astrological charts.

> ‚ö†Ô∏è **Disclaimer**: More than 90% of this code is generated by AI. Use at your own risk.

## Features

- ‚úÖ **Clean API**: Single `generateLaSo()` function
- ‚úÖ **Type-Safe**: Full TypeScript support with complete type definitions
- ‚úÖ **Minimal Dependencies**: Only 1 runtime dependency (lunar-javascript), runs on Bun, Node.js, and browsers
- ‚úÖ **Dual Calendar Support**: Gregorian (d∆∞∆°ng l·ªãch) and Lunar (√¢m l·ªãch)
- ‚úÖ **Multiple Output Formats**: JSON and human-readable text
- ‚úÖ **Direct Property Access**: Access chart data as typed properties
- ‚úÖ **140+ Stars**: Complete star positioning including 14 main stars, T·ª© H√≥a, auxiliary stars
- ‚úÖ **12 Palaces**: Full palace system with L·ª•c Th√¢n
- ‚úÖ **Bureau Calculation**: Automatic C·ª•c (bureau) determination
- ‚úÖ **No UI Components**: Pure calculation engine

## Installation

```bash
bun install tuvi-neo
```

Or with npm:
```bash
npm install tuvi-neo
```

## Quick Start

```typescript
import { generateLaSo } from 'tuvi-neo';

const laso = generateLaSo({
  name: 'Nguy·ªÖn VƒÉn A',
  gender: 'male',
  birth: {
    isLunar: false,      // Gregorian calendar
    year: 1990,
    month: 5,
    day: 15,
    hour: 8,
    minute: 30,
  },
});

// Access properties directly
console.log(laso.Info.ChuMenh);     // "Ph√° qu√¢n"
console.log(laso.Info.ThanCu);      // "Th√¢n c∆∞ Phu th√™"

// Get JSON output
console.log(laso.toJSONString());

// Get human-readable text
console.log(laso.toDisplayString());
```

## API Reference

### `generateLaSo(input: GenerateLaSoInput): LaSoResult`

Generate a complete Vietnamese Ziwei Doushu natal chart.

**Parameters:**

```typescript
interface GenerateLaSoInput {
  name: string;
  gender: 'male' | 'female';
  birth: {
    isLunar: boolean;   // true = lunar (√¢m l·ªãch), false = Gregorian (d∆∞∆°ng l·ªãch)
    year: number;       // e.g., 1990
    month: number;      // 1-12
    day: number;        // 1-31
    hour: number;       // 0-23 (24-hour format)
    minute?: number;    // 0-59 (optional, defaults to 0)
  };
}
```

**Returns:** `LaSoResult` object

### LaSoResult Properties

#### `Info: LaSoInfo`
General chart information:
- `AmDuong`: Yin/Yang + Gender (e.g., "D∆∞∆°ng Nam")
- `VTMenh`: Life Palace position (1-12)
- `CanNam`: Year Heavenly Stem (shifted index 0-9)
- `ChiNam`: Year Earthly Branch (shifted index 0-11)
- `Nam`: Year in Stem-Branch format (e.g., "Canh Ng·ªç")
- `Gio`: Birth hour name (e.g., "T√≠")
- `Cuc`: Bureau name (e.g., "Th·ªï ng≈© c·ª•c")
- `CucNH`: Bureau number (2-6)
- **`ChuMenh`**: Life Lord star (determined by year branch)
- **`ChuThan`**: Body Lord star (determined by year branch)
- **`ThanCu`**: Body Palace location (e.g., "Th√¢n c∆∞ M·ªánh")

#### `Cac_cung: LaSoCung[]`
Array of 12 palaces, each containing:
- `Name`: Palace name (L·ª•c Th√¢n)
- `Than`: Body Palace indicator (0 or 1)
- `ChinhTinh`: Array of main stars
- `Saotot`: Array of auspicious stars
- `Saoxau`: Array of inauspicious stars
- `TrangSinh`: Life stage
- T·ª© H√≥a indicators: `LocNhap`, `KyNhap`, `QuyenNhap`, `KhoaNhap`

### LaSoResult Methods

#### `toJSONString(pretty?: boolean): string`
Convert to JSON string.
- `pretty`: If true, formats with indentation (default: true)

```typescript
const json = laso.toJSONString();     // Pretty-printed
const compact = laso.toJSONString(false);  // Compact
```

#### `toDisplayString(): string`
Convert to human-readable Vietnamese text format.

```typescript
const text = laso.toDisplayString();
console.log(text);
// Output:
// === L√Å S·ªê T·ª¨ VI ===
// T√™n: Nguy·ªÖn VƒÉn A
// Gi·ªõi t√≠nh: Nam
// ...
```

#### `getRawData(): LaSo`
Get raw internal data structure (for advanced usage).

## Examples

### Example 1: Gregorian Calendar (Most Common)

```typescript
import { generateLaSo } from 'tuvi-neo';

const laso = generateLaSo({
  name: 'Nguy·ªÖn VƒÉn A',
  gender: 'male',
  birth: {
    isLunar: false,
    year: 1990,
    month: 5,
    day: 15,
    hour: 8,
    minute: 30,
  },
});
```

### Example 2: Lunar Calendar

```typescript
import { generateLaSo } from 'tuvi-neo';

const laso = generateLaSo({
  name: 'Tr·∫ßn Th·ªã B',
  gender: 'female',
  birth: {
    isLunar: true,
    year: 1985,
    month: 3,
    day: 20,
    hour: 14,
    minute: 0,
  },
});
```

### Example 3: Accessing Specific Data

```typescript
import { generateLaSo } from 'tuvi-neo';

const laso = generateLaSo({...});

// Get Life Palace
const lifePalaceIndex = laso.Info.VTMenh - 1;
const lifePalace = laso.Cac_cung[lifePalaceIndex];

console.log(`Life Palace: ${lifePalace.Name}`);
console.log(`Main Stars: ${lifePalace.ChinhTinh.map(s => s.Name).join(', ')}`);

// Count total stars
const totalStars = laso.Cac_cung.reduce(
  (sum, palace) => sum + palace.nChinhTinh + palace.nSaoTot + palace.nSaoXau,
  0
);
console.log(`Total stars: ${totalStars}`);
```

### Example 4: Save to File

```typescript
import { generateLaSo } from 'tuvi-neo';
import { writeFileSync } from 'fs';

const laso = generateLaSo({...});

// Save JSON
writeFileSync('chart.json', laso.toJSONString());

// Save text
writeFileSync('chart.txt', laso.toDisplayString());
```

## Hour Conversion

Minutes are automatically rounded to the nearest hour:
- `0:00-0:29` ‚Üí Hour 0 (T√Ω)
- `0:30-1:29` ‚Üí Hour 1
- `8:00-8:29` ‚Üí Hour 8 (Th√¨n)
- `8:30-9:29` ‚Üí Hour 9 (Th√¨n/T·ªã boundary)

The system automatically converts 24-hour format to the 12 ƒê·ªãa Chi hours used in Vietnamese astrology.

## TypeScript Support

Full type definitions are included:

```typescript
import type { 
  GenerateLaSoInput,
  LaSoResult,
  LaSoInfo,
  LaSoCung,
  Gender,
  BirthInfo 
} from 'tuvi-neo';

function analyze(laso: LaSoResult): void {
  // TypeScript knows all properties and their types
  const { Info, Cac_cung } = laso;
  console.log(Info.ChuMenh);  // string
  console.log(Info.VTMenh);   // number
  console.log(Cac_cung[0].ChinhTinh);  // CungStar[]
}
```

## Run Examples

```bash
# Basic example
bun run examples/example-basic.ts

# New API examples
bun run examples/example-new-api.ts
```

## Project Structure

```
src/
  ‚îú‚îÄ‚îÄ generate-laso.ts      # Main API entry point
  ‚îú‚îÄ‚îÄ laso-result.ts        # Result class with formatting methods
  ‚îú‚îÄ‚îÄ laso.ts               # Internal chart generation
  ‚îú‚îÄ‚îÄ an-sao.ts             # Star positioning engine (753 lines)
  ‚îú‚îÄ‚îÄ sao-database.ts       # 111 star definitions + lookup tables
  ‚îú‚îÄ‚îÄ json-formatter.ts     # JSON output formatter
  ‚îú‚îÄ‚îÄ calendar-converter.ts # Gregorian ‚Üî Lunar conversion
  ‚îî‚îÄ‚îÄ types.ts              # TypeScript type definitions
```

## Key Concepts

### Life Lord (Ch·ªß M·ªánh) & Body Lord (Ch·ªß Th√¢n)
Determined by birth year's Earthly Branch:
- **Ng·ªç year** ‚Üí ChuMenh: Ph√° qu√¢n, ChuThan: H·ªèa tinh
- **T√Ω year** ‚Üí ChuMenh: Tham lang, ChuThan: H·ªèa tinh

See [JSON Format Reference](docs/JSON_FORMAT.md) for complete mapping tables.

### Body Palace Location (Th√¢n C∆∞)
Shows which palace the Body (Th√¢n) resides in, calculated from birth month and hour.
Format: "Th√¢n c∆∞ [Palace Name]" (e.g., "Th√¢n c∆∞ M·ªánh")

### Bureau (C·ª•c)
Determines the distribution of main stars:
- Th·ªßy nh·ªã c·ª•c (Water 2)
- M·ªôc tam c·ª•c (Wood 3)
- Kim t·ª© c·ª•c (Metal 4)
- Th·ªï ng≈© c·ª•c (Earth 5)
- H·ªèa l·ª•c c·ª•c (Fire 6)

## Documentation

üìÅ **[Documentation Index](docs/)** - All documentation files

- **[API Summary](docs/API-SUMMARY.md)** - Quick reference guide
- **[JSON Format Reference](docs/JSON_FORMAT.md)** - Complete JSON structure reference
- **[Usage Examples](docs/EXAMPLES.md)** - Detailed usage examples
- **[API Migration Guide](docs/VERIFICATION.md)** - Refactoring and migration details

üíª **[Code Examples](examples/)** - Runnable examples

- **[example-basic.ts](examples/example-basic.ts)** - Basic usage
- **[example-new-api.ts](examples/example-new-api.ts)** - Comprehensive examples

‚öôÔ∏è **Development**

- **[CLAUDE.md](CLAUDE.md)** - Bun development guidelines
- **[ORGANIZATION.md](ORGANIZATION.md)** - Project structure guide

## Notes

- This is a **calculation engine only** - no UI components
- ‚úÖ Supports both Gregorian and Lunar calendar input
- Automatic lunar calendar conversion using `lunar-javascript` library
- All 140+ stars are calculated and positioned
- Complete T·ª© H√≥a (Four Transformations) support

## Credits

Ported from C# legacy code to TypeScript for modern JavaScript environments.

## License

MIT
